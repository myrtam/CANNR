<!DOCTYPE html>
<!--
CANNR TM analytics container building tool project editing page.
Copyright 2020 Pat Tendick ptendick@gmail.com
All rights reserved
Maintainer Pat Tendick ptendick@gmail.com
-->
<html>
<head>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel='stylesheet' href='css/cnr.css'>
<link rel='stylesheet' href='css/modal.css'>
<!--  
<link rel='stylesheet' href='fontawesome/css/all.css'>
-->
<script src="jquery-2.0.1.min.js"></script>
<script src="bootstrap.min.js"></script>
<script src="common.js"></script>
<script src="project.js"></script>
<meta charset="UTF-8">
<title>CANNR Tool</title>
</head>

<body style="background-color:#F5F5F5;">

<div class="top-margin">
<h2 id='projectPageTitle'>&nbsp;</h2>
<br>
<div>
<p>Add folders containing code and other files.</p>
<button type="button" id="newFolderButton" class="enabled-button" onclick="onGoFolder(true)">New Folder...</button>
</div>
<br>
<span id='folderSelectLabel'>Folders:</span><br>
<div class="input-group mb-3" id="folderSelectGroup">
	<select class="custom-select" id="folderSelect">
	</select>
</div>
<br>
<div>
	<button type="button" id="goFolderButton" class="enabled-button" onclick="onGoFolder(false)">Go...</button>&nbsp;
	<button type="button" id="delFolderButton" class="enabled-button" onclick="onDelFolder()">Delete</button>
</div>
<br>
<br>
<!--
If no folders, display the following:
<h3>You currently have no folders.  Would you like to add one?<h3>
-->
<div>
<button type="button" id="projectProps" class="enabled-button" onclick="onProjectProps()">Project Properties...</button>
</div>
<br>
<br>
<!-- Include this when object stores implemented
<div class="input-group mb-3" id="objectStoreSelectGroup">
	<select class="custom-select" id="projectSelect" onchange="onObjectStoreSelectChange()" onclick="onProjectSelect()">
	</select>
</div>
<div>
<button type="button" id="goObjectButton" class="enabled-button" onclick="onGoObject()">Go</button>
</div>
<br>
<div>
<button type="button" id="addObjectStore" class="enabled-button" onclick="onAddObjectStore()">New Object Store...</button>
</div>
<br>
<br>
-->
<!-- Don't save in this page.
<button id="saveProjectButton" class="enabled-button" onclick='onSaveProject()'>Save</button>
-->
<button id="buildButton" class="enabled-button" onclick='onGoBuild()'>Build...</button>
<!--  
<button id="exportButton" class="enabled-button" onclick='onExportProject()'>Export...</button>
<button id="importButton" class="enabled-button" onclick='onImportProject()'>Import...</button>
-->
<button id="exitProjectButton" class="enabled-button" onclick='onExitProject()'>Exit</button>
</div>
<br>

<!-- Modal for project properties -->
<div id="projectPropertiesModal" class="simple-modal">
  <!-- Modal content -->
  <div class="simple-modal-content">
    <div class="simple-modal-header">
      <span class="simple-close" onclick="onProjectCancel()">&times;</span>
      <h5 id="projectPropertiesTitle">Project Properties</h5>
      <hr>
    </div>
    <div class="simple-modal-body">
		<table id="projectTable" class="table" style="border-collapse: collapse;">
			<tbody id="projectBody">
				<tr>
					<td style="border: none;">Project Name:</td>
					<td style="border: none;"><textarea name="projectNameInput" id="projectNameInput"  rows="1" cols="50" onchange="onChangeProjectName()"/></textarea>
					<span id='projectNameRules'>&nbsp;*<br>Lower case letters, numbers, and underscores, &le;30 characters.</span>
					</td>
				</tr>
				<tr>
					<td style="border: none;">Title:</td>
					<td style="border: none;"><textarea name="projectTitleInput" id="projectTitleInput" rows="1" cols="50"/></textarea></td>
				</tr>
				<tr>
					<td style="border: none;">Description:</td>
					<td style="border: none;"><textarea name="projectDescriptionInput" id="projectDescriptionInput" maxlength="500"  rows="4" cols="50"/></textarea></td>
				</tr>
			</tbody>
		</table>
    </div>
    <div class="simple-modal-footer">
      <hr>
        <!-- If new project, this button returns to the main page, otherwise returns to the Project page -->
        <button type="button" id="projectBack" class="enabled-button" onclick="onProjectCancel()">Back</button>
        <!-- If existing project, this button is labeled Save not Next, and returns to the Project page -->
        <button type="button" id="projectNext" class="enabled-button" onclick="onProjectNext()" style="float: right;">Next</button>
    </div>
  </div>
</div>

<!-- Modal for folder properties -->
<div id="folderPropertiesModal" class="simple-modal">
  <!-- Modal content -->
  <div class="simple-modal-content">
    <div class="simple-modal-header">
      <span class="simple-close" onclick="onCancel()">&times;</span>
      <h5 id="folderPropertiesTitle">Folder Properties</h5>
      <div id='titleFolderPath' style='visibility: hidden'>
	      <span>/</span><span id="titleFolder"></span>
      </div>
      <hr>
    </div>
    <div class="simple-modal-body">
		<table id="folderTable" class="table" style="border-collapse: collapse;">
			<tbody id="folderBody">
				<tr>
					<td style="border: none;">Folder Name:</td>
					<td style="border: none;"><textarea name="folderNameInput" id="folderNameInput" rows="1" cols="50" onchange="onChangeFolderName()"/></textarea>
					<span id='folderNameRules'>&nbsp;*<br>Lower case letters, numbers, and underscores, &le;30 characters.</span>
					</td>
				</tr>
				<tr>
					<td style="border: none;">Language:</td>
					<td style="border: none;">
					<input name="language" id="languageR" type="radio"/>
					<label for="languageR">R</label>&nbsp;&nbsp;&nbsp;
					<input name="language" id="languageP" type="radio"/>
					<label for="languageP">Python</label><span id='languageRules'>*</span>
					</td>
				</tr>
				<tr>
					<td style="border: none;">Upload Source Directory:</td>
					<td id='sourceUploadCell' style="border: none;">
						<input name="sourceUpload" type="file" id="sourceUpload" webkitdirectory mozdirectory 
							onchange='onSourceUploadChange()'/>
						<!--  
						<input name="sourceUpload" type="file" id="sourceUpload" onchange='onSourceUploadChange()'/>
						-->
						<span id='uploadRequired'>&nbsp;*</span>
					</td>
				</tr>
				<tr>
					<td style="border: none;">Source Directory:</td>
					<td id="sourcePathInput" style="border: none;"></td>
				</tr>
				<tr>
					<td style="border: none;">Workers:</td>
					<td style="border: none;"><input name="workersInput" id="workersInput" type="number" value=2 min=1 max=1024/>
					<span id='workerRules'>&nbsp;*</span>
					</td>
				</tr>
				<tr id='modulesRow'>
					<td id='modulesLabel' style="border: none;">Modules:</td>
					<td style="border: none;">
						<select class="custom-select" id="moduleSelect">
						</select>
						<br>
						<button type="button" id="goModuleButton" class="enabled-button" onclick="onGoModule(false)">Go...</button>&nbsp;
						<button type="button" id="delModuleButton" class="enabled-button" onclick="onDelModule()">Delete</button>
					</td>
				<tr id='newModulesRow'>
					<td style="border: none;"></td>
					<td style="border: none;">
						<button type="button" id="newModuleButton" class="enabled-button" onclick="onGoModule(true)">New Module...</button>
					</td>
				</tr>
			</tbody>
		</table>
    </div>
    <div class="simple-modal-footer">
      <hr>
        <!-- If existing project, this button is labeled Cancel, and returns to the Project Properties screen -->
        <button type="button" id="folderBack" class="enabled-button" onclick="onFolderBack()">Back</button>
        <!-- If existing project, this button is labeled Save not Next, and returns to the Project Properties screen -->
        <button type="button" id="folderNext" class="enabled-button" onclick="onFolderNext()" style="float: right;">Next</button>
    </div>
  </div>
</div>

<!-- Modal for module properties -->
<div id="modulePropertiesModal" class="simple-modal">
  <!-- Modal content -->
  <div class="simple-modal-content">
    <div class="simple-modal-header">
      <span class="simple-close" onclick="onCancel()">&times;</span>
      <h5 id="modulePropertiesTitle">Module Properties</h5>
      <div id='titleModulePath' style='visibility: hidden'>
	      <span>/</span><span id="titleModuleFolder"></span>/<span id="titleModuleModule"></span>
      </div>
      <hr>
    </div>
    <div class="simple-modal-body">
		<table id="moduleTable" class="table" style="border-collapse: collapse;">
			<tbody id="moduleBody">
				<tr>
					<td style="border: none;">Module Name:</td>
					<td style="border: none;"><input name="moduleNameInput" id="moduleNameInput" type="text" maxlength="30" style="width: 30em;" onchange="onChangeModuleName()"/>
					<span id='moduleNameRules'>&nbsp;*<br>Lower case letters, numbers, and underscores, &le;30 characters.</span>
					</td>
				</tr>
				<tr>
					<td style="border: none;">Title:</td>
					<td style="border: none;"><input name="moduleTitleInput" id="moduleTitleInput" type="text" maxlength="50" style="width: 30em;"/></td>
				</tr>
				<tr>
					<td style="border: none;">Description:</td>
					<td style="border: none;"><textarea name="moduleDescriptionInput" id="moduleDescriptionInput" maxlength="500" rows="2" cols="60"/></textarea></td>
				</tr>
				<tr>
					<td style="border: none;">Source File:</td>
					<td style="border: none;">
						<select class="custom-select" id="fileSelect">
						</select>
						<span id='fileSelectRules'>&nbsp;*</span>
					</td>
				</tr>
				<tr id='servicesRow'>
					<td style="border: none;">Services:</td>
					<td style="border: none;">
						<select class="custom-select" id="serviceSelect">
						</select>
						<br>
						<button type="button" id="goServiceButton" class="enabled-button" onclick="onGoService(false)">Go...</button>&nbsp;
						<button type="button" id="delServiceButton" class="enabled-button" onclick="onDelService()">Delete</button>
					</td>
				<tr id='newServicesRow'>
					<td style="border: none;"></td>
					<td style="border: none;">
						<button type="button" id="newServiceButton" class="enabled-button" onclick="onGoService(true)">New Service...</button>
					</td>
				</tr>
				<tr>
					<td style="border: none;">Required Packages:</td>
					<td style="border: none;">
						<input name="packageInput" id="packageInput" type="text" style="width: 15em;"/>
						<button id="packageAddButton" onclick="onPackageAdd()" style="padding: 0px"><img src="gt.png" style="width:75%; height:75%;"></button>
						<!--  
						<button id="packageAddButton" onclick="onPackageAdd()">&gt;</button>
						-->
						<select name="packageSelect" id="packageSelect" style="width: 15em;" onChange='onPackageSelectChange()'></select>
						<!--  
						<button id="packageDelButton" onclick="onPackageDel()" class="far fa-trash-alt"></button>
						<button id="packageDelButton" onclick="onPackageDel()">&times;</button>
						-->
						<button id="packageDelButton" onclick="onPackageDel()" style="padding: 0px"><img src="compost.png" style="width:75%; height:75%;"></button>
					</td>
				</tr>
				<tr id='importPathsRow'>
					<td style="border: none;">Python Import Paths:</td>
					<td style="border: none;">
						<input name="pathInput" id="pathInput" type="text" style="width: 15em;"/>
						<button id="pathAddButton" onclick="onPathAdd()" style="padding: 0px"><img src="gt.png" style="width:75%; height:75%;"></button>
						<select name="pathSelect" id="pathSelect" style="width: 15em;" onChange='onPathSelectChange()'></select>
						<button id="pathDelButton" onclick="onPathDel()" style="padding: 0px"><img src="compost.png" style="width:75%; height:75%;"></button>
					</td>
				</tr>
			</tbody>
		</table>
    </div>
    <div class="simple-modal-footer">
      <hr>
        <button type="button" id="moduleBack" class="enabled-button" onclick="onModuleBack()">Back</button>
        <button type="button" id="moduleNext" class="enabled-button" onclick="onModuleNext()" style="float: right;">Next</button>
    </div>
  </div>
</div>

<!-- Modal for service properties -->
<div id="servicePropertiesModal" class="simple-modal">
  <!-- Modal content -->
  <div class="simple-modal-content">
    <div class="simple-modal-header">
      <span class="simple-close" onclick="onCancel()">&times;</span>
      <h5 id="servicePropertiesTitle">Service Properties</h5>
      <!--
      Use information entered to build sample URL.
      -->
      <div id='titleServicePath' style='visibility: hidden'>
	      <span>http://&lt;domain or ip&gt;</span><span id="titleServicePort"></span>/services/<span id="titleServiceFolder"></span>/<span id="titleServiceModule"></span>/<span id="titleServiceService"></span>
      </div>
      <hr>
    </div>
    <div class="simple-modal-body">
		<table id="serviceTable" class="table" style="border-collapse: collapse;">
			<tbody id="serviceBody">
				<tr>
					<td style="border: none;">Service Name:</td>
					<td style="border: none;"><input name="serviceNameInput" id="serviceNameInput" type="text" maxlength="30" style="width: 30em;" onchange="onChangeServiceName()"/>
					<span id='serviceNameRules'>&nbsp;*<br>Lower case letters, numbers, and underscores, &le;30 characters.</span>
					</td>
				</tr>
				<tr>
					<td style="border: none;">Title:</td>
					<td style="border: none;"><input name="serviceTitleInput" id="serviceTitleInput" type="text" maxlength="50" style="width: 30em;"/></td>
				</tr>
				<tr>
					<td style="border: none;">Description:</td>
					<td style="border: none;"><textarea name="serviceDescriptionInput" id="serviceDescriptionInput" maxlength="500" rows="2" cols="60"/></textarea></td>
				</tr>
				<tr>
					<td style="border: none;">Function:</td>
					<td style="border: none;">
						<select class="custom-select" id="functionSelect">
						</select>
						<span id='functionSelectRules'>&nbsp;*</span>
					</td>
				</tr>
				<tr>
					<td style="border: none;"></td>
					<td id='inputComments' style="border: none;">The function should have 1 argument:  The request body as a JSON string.</td>
				</tr>
				<tr>
					<td style="border: none;">HTTP Method:</td>
					<td style="border: none;">
					<input name="method" id="methodPOSTInput" type="radio" value="POST" checked="checked" onchange='checkServiceProperties()'/>
					<label for="methodPOSTInput">POST</label>&nbsp;&nbsp;&nbsp;
					<input name="method" id="methodGETInput" type="radio" value="GET" onchange='checkServiceProperties()'/>
					<label for="methodGETInput">GET</label>
					*</td>
				</tr>
				<tr>
					<td style="border: none;">Include Parameters:</td>
					<td style="border: none;">
						<input name="includeBodyInput" id="includeBodyInput" type="checkbox" onchange='checkServiceProperties()'/>&nbsp;
						<label for="includeBodyInput">Include HTTP request body?</label><br>
						<input name="includeParamsInput" id="includeParamsInput" type="checkbox" onchange='checkServiceProperties()'/>&nbsp;
						<label for="includeParamsInput">Include HTTP query parameters?</label><br>
						<input name="paramsToDFInput" id="paramsToDFInput" type="checkbox" onchange='checkServiceProperties()'/>&nbsp;
						<label for="paramsToDFInput">Parse the parameters into a data frame?</label><br>
						<input name="includeRequestInput" id="includeRequestInput" type="checkbox" onchange='checkServiceProperties()'/>&nbsp;
						<label for="includeRequestInput">Include HTTP request object?</label><br>
					</td>
				</tr>
				<tr id='parseInputRow'>
					<td style="border: none;">Parse Input (Body) As:</td>
					<td style="border: none;">
					<select name="inputParseTypeInput" id="inputParseTypeInput" style="width: 15em;">
						<option value="none">Do not parse</option>
						<option value="dataFrame">Data frame</option>
						<option value="list">List</option>
						<option value="vector">Vector</option>
						<option value="matrix">Matrix</option>
					</select>
					</td>
				</tr>
				<tr>
					<td style="border: none;">Convert Output From:</td>
					<td style="border: none;">
					<select name="outputParseTypeInput" id="outputParseTypeInput" style="width: 15em;">
						<option value="none">Do not convert</option>
						<option value="dataFrame">Data frame</option>
						<option value="list">List</option>
						<option value="vector">Vector</option>
						<option value="matrix">Matrix</option>
					</select>
					</td>
				</tr>
			</tbody>
		</table>
    </div>
    <div class="simple-modal-footer">
      <hr>
        <button type="button" id="serviceBack" class="enabled-button" onclick="onServiceBack()">Back</button>
        <!-- If new project, the user is next asked if they want to build the project -->
        <button type="button" id="serviceNext" class="enabled-button" onclick="onServiceNext()" style="float: right;">Next</button>
    </div>
  </div>
</div>

<!-- Modal for project build -->
<div id="projectBuildModal" class="simple-modal">
  <!-- Modal content -->
  <div class="simple-modal-content">
    <div class="simple-modal-header">
      <span class="simple-close" onclick="onCancel()">&times;</span>
      <h5 id="projectBuildTitle">Build Project</h5>
      <hr>
    </div>
    <div class="simple-modal-body">
		<input name="generateDockerfile" id="generateDockerfile" type="checkbox"/>&nbsp;
		<label for="generateDockerfile">Generate Docker project?</label><br>
		<input name="buildContainer" id="buildContainer" type="checkbox" disabled=true style="visibility: hidden;"/>&nbsp;
		<label for="buildContainer" style="visibility: hidden;">Build container?</label><br>
		<input name="startLocalhost" id="startLocalhost" type="checkbox" disabled=true style="visibility: hidden;"/>&nbsp;
		<label for="startLocalhost" style="visibility: hidden;">Start container on localhost?</label><br>
		<h5>Status:</h5>
		<div id="statusPane" class="build-list">
		</div>
    </div>
    <div class="simple-modal-footer">
      <hr>
        <button type="button" id="buildProjectButton" class="enabled-button" onclick="onBuildProject()">Build</button>
        <button type="button" id="cancelBuildButton" class="enabled-button" onclick="onCancelBuild()">Cancel</button>
        <button type="button" id="downloadDockerButton" class="enabled-button" onclick="onDownloadDocker()" style="visibility: hidden;">Download...</button>
    </div>
  </div>
</div>

</body>
<script type="text/javascript">

// Initialize the DOM object variables
initDOMObjects();

// Get the project, if applicable, and initialize the page
getProject();

</script>
</html>